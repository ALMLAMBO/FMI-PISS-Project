<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Профил</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" href="profile.css">
</head>


<body>
    <div class="header">
        <div id="Header_Icon"></div>
        <div class="page-title">
            <a class="upper_button" id="Reviews" href="Reviews_Select.html">Заглавна</a>
            <a class="upper_button" id="Profile_Button" href="Profile.html">Профил</a>

        </div>
    </div>

    <div class="main-container">
        <div class="page-title">
            <div class="page-title-text" id="username"></div>
            <div class="page-description">
                <div class="userInfo" id="userInfo">
                    <div class="infoTitle">Имейл: </div>
                    <div class="infoElement" id="email"></div>
                </div>
                <div class="userInfo">
                    <div class="infoTitle">Университет: </div>
                    <div class="infoElement" id="university"></div>
                </div>
                <div class="userInfo">
                    <div class="infoTitle">Факултет: </div>
                    <div class="infoElement" id="faculty"></div>
                </div>
                <div class="userInfo">
                    <div class="infoTitle">Специалност: </div>
                    <div class="infoElement" id="degree"></div>
                </div>
            </div>
        </div>


        <div class="discipline-container">
            <div class="discipline-title">Дисциплини</div>
            <div class="discipline-names">
                <div class="discipline-name">a</div>
                <div class="discipline-name">a</div>
                <div class="discipline-name">a</div>
            </div>
        </div>

        <div class="review-title">Рецензии</div>
        <div class="reviews">
            <div class="review">
                <div class="main-container">
                    <div class="info-row">
                        <div class="info-name-description">Специалност</div>
                        <div class="info-name" id="specialty-name">Софт Уни</div>
                    </div>
                    <div class="info-row">
                        <div class="info-name-description">Дисциплина</div>
                        <div class="info-name" id="discipline-name">Темпорару</div>
                        <div class="score">
                            <div class="score-info" id="course-score">4</div>
                            <div class="score-star"></div>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="info-name-description">Преподавател</div>
                        <div class="info-name" id="teacher-name">Божани</div>
                        <div class="score">
                            <div class="score-info" id="teacher-score">4</div>
                            <div class="score-star"></div>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="info-name-description">Асистент</div>
                        <div class="info-name" id="assistant-name">София</div>
                        <div class="score">
                            <div class="score-info" id="assistant-score">4</div>
                            <div class="score-star"></div>
                        </div>
                    </div>
                </div>
                <div class="comment-container">
                    <div class="comment-text">Коментар:</div>
                    <div class="comment-field">
                        <div class="comment-field-text">texta a aaa aa a a a a a a a a a a a </div>
                    </div>
                </div>
                <div class="final-container">
                    <div class="extras-container">
                        <div class="extras-container-row"></div>
                        <div class="extra-showcase" id="extra-showcase-exam">Изпит</div>
                        <div class="extra-showcase" id="extra-showcase-project">Проект</div>
                        <div class="extra-showcase" id="extra-showcase-exams">Контролни</div>
                        <div class="extra-showcase" id="extra-showcase-homework">Домашни</div>
                        <div class="extra-showcase" id="extra-showcase-online-classes">Онлайн часове</div>
                        <div class="extra-showcase" id="extra-showcase-books">Учебници</div>
                        <div class="extra-showcase" id="extra-showcase-presentations">Презентации</div>
                        <div class="extra-showcase" id="extra-showcase-more-meterials">Допълнителни материали</div>
                    </div>
                    <div class="scores-container">
                        <div class="score-text">Оценки:</div>
                        <div class="scores-show">
                            <div class="score-element-text">Заетост</div>
                            <div class="score-element-score" id="busyness">2</div>
                        </div>
                        <div class="scores-show">
                            <div class="score-element-text">Сложност</div>
                            <div class="score-element-score" id="difficulty">3</div>
                        </div>
                        <div class="scores-show">
                            <div class="score-element-text">Полезност</div>
                            <div class="score-element-score" id="usefulness">1</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <footer class="footer">
        <div class="icon_Container">
            <div id="Footer_Icon"></div>
        </div>
        <div class="footer_links">
            <div class="footer_link">>> За нас</div>
            <div class="footer_link">>> Информация за Университета</div>
            <div class="footer_link">>> Включване на Университет</div>
        </div>
    </footer>

    <script>
        class Review {
            constructor(specialtyName, disciplineName, courseScore, teacherName, teacherScore, assistantName, assistantScore, commentFieldText,
                        hasExam, hasProject, hasMidChecks, hasHomeworks, hasOnlineClasses, hasBooks, hasPresentations, hasAdditionalMaterials,
                        busyness, difficulty, usefulness) {
                this.specialtyName = specialtyName;
                this.disciplineName = disciplineName;
                this.courseScore = courseScore;
                this.teacherName = teacherName;
                this.teacherScore = teacherScore;
                this.assistantName = assistantName;
                this.assistantScore = assistantScore;
                this.commentFieldText = commentFieldText;
                this.hasExam = hasExam;
                this.hasProject = hasProject;
                this.hasMidChecks = hasMidChecks;
                this.hasHomeworks = hasHomeworks;
                this.hasOnlineClasses = hasOnlineClasses;
                this.hasBooks = hasBooks;
                this.hasPresentations = hasPresentations;
                this.hasAdditionalMaterials = hasAdditionalMaterials;
                this.busyness = busyness;
                this.difficulty = difficulty;
                this.usefulness = usefulness;
            }
        }

        function generateReviewHTML(review) {
            const extrasMapping = {
                hasExam: 'Exam',
                hasProject: 'Project',
                hasMidChecks: 'Mid Checks',
                hasHomeworks: 'Homeworks',
                hasOnlineClasses: 'Online Classes',
                hasBooks: 'Books',
                hasPresentations: 'Presentations',
                hasAdditionalMaterials: 'Additional Materials'
            };
            let extrasHTML = '';
            for (const [key, value] of Object.entries(extrasMapping)) {
                if (review[key]) {
                    extrasHTML += `<div class="extra-showcase" id="extra-showcase-${key}">${value}</div>`;
                }
            }
            return `
                <div class="review">
                    <div class="main-container">
                        <div class="info-row">
                            <div class="info-name-description">Специалност</div>
                            <div class="info-name" id="specialty-name">${review.specialtyName}</div>
                        </div>
                        <div class="info-row">
                            <div class="info-name-description">Дисциплина</div>
                            <div class="info-name" id="discipline-name">${review.disciplineName}</div>
                            <div class="score">
                                <div class="score-info" id="course-score">${review.courseScore}</div>
                                <div class="score-star"></div>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-name-description">Преподавател</div>
                            <div class="info-name" id="teacher-name">${review.teacherName}</div>
                            <div class="score">
                                <div class="score-info" id="teacher-score">${review.teacherScore}</div>
                                <div class="score-star"></div>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-name-description">Асистент</div>
                            <div class="info-name" id="assistant-name">${review.assistantName}</div>
                            <div class="score">
                                <div class="score-info" id="assistant-score">${review.assistantScore}</div>
                                <div class="score-star"></div>
                            </div>
                        </div>
                    </div>
                    <div class="comment-container">
                            <div class="comment-text">Коментар:</div>
                            <div class="comment-field">
                            <div class="comment-field-text">${review.commentFieldText}</div>
                            </div>
                            </div>
                            <div class="final-container">
                            <div class="extras-container">
                            <div class="extras-container-row">
                            ${extrasHTML}
                            </div>
                            </div>
                            <div class="scores-container">
                            <div class="score-text">Оценки:</div>
                            <div class="scores-show">
                            <div class="score-element-text">Заетост</div>
                            <div class="score-element-score" id="busyness">${review.busyness}</div>
                            </div>
                            <div class="scores-show">
                            <div class="score-element-text">Сложност</div>
                            <div class="score-element-score" id="difficulty">${review.difficulty}</div>
                            </div>
                            <div class="scores-show">
                            <div class="score-element-text">Полезност</div>
                            <div class="score-element-score" id="usefulness">${review.usefulness}</div>
                            </div>
                            </div>
                            </div>
                            </div>`;
                }


        function addReviewsToProfile(userInfoData) {
            const reviewsContainer = document.querySelector('.reviews');
            userInfoData.reviews.forEach(review => {
                const reviewHTML = generateReviewHTML(review);
                reviewsContainer.innerHTML += reviewHTML;
            });
        }

        function populateUserInfo(userInfoData) {
            document.getElementById('username').textContent = userInfoData.username;
            document.getElementById('email').textContent = userInfoData.email;
            document.getElementById('university').textContent = userInfoData.university;
            document.getElementById('faculty').textContent = userInfoData.faculty;
            document.getElementById('degree').textContent = userInfoData.degree;

            const disciplinesContainer = document.querySelector('.discipline-names');
            disciplinesContainer.innerHTML = ''; 

            userInfoData.disciplines.forEach(discipline => {
                const disciplineLink = document.createElement('a');
                disciplineLink.className = 'discipline-name';
                disciplineLink.href = `/create_review/id=${discipline.id}`;
                disciplineLink.textContent = discipline.courseName;

                disciplinesContainer.appendChild(disciplineLink);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const formData={userId:sessionStorage.getItem('userId')};
            $.ajax({
                url: 'http://localhost:8080/api/user/get-user-info',
                type: 'post',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + sessionStorage.getItem('token')
                },
                dataType: 'json',
                data: JSON.stringify(formData),
                success:function (data){
                    console.log(data);
                    populateUserInfo(data);
                    addReviewsToProfile(data);
                }
            });

        });
        
    </script>
</body>